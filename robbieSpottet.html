<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Robbie Spottet - SkateMesh</title>
  <link href="stylesheet.css" rel="stylesheet">
</head>
<body>

  <a href="index.html" class="logo-link">
    <img src="Images/Logo.png" alt="SkateMesh Logo">
  </a>

  <button class="burger-menu-btn" id="burger-menu-btn" aria-label="Menu">
    <span class="burger-line"></span>
    <span class="burger-line"></span>
    <span class="burger-line"></span>
  </button>

  <div class="slide-menu-backdrop" id="slide-menu-backdrop"></div>
  <div class="slide-menu" id="slide-menu">
    <div class="slide-menu-content">
      <button class="slide-menu-close" id="slide-menu-close" aria-label="Close">&times;</button>
      <nav class="slide-menu-nav">
        <a href="index.html">Home</a>
        <a href="robbieSpottet.html">Robbie Spottet</a>
        <a href="#">Skate Scene</a>
        <a href="#">Laessoes Gade</a>
        <a href="#">About</a>
        <a href="#">Contact</a>
      </nav>
    </div>
  </div>

  <div class="hero-carousel-wrapper">
    <div class="hero-carousel">
      <img src="Images/RobbieSpottet/RS-1.jpeg" alt="Robbie Spottet" class="hero-carousel-image">
      <img src="Images/RobbieSpottet/RS-2.jpeg" alt="Robbie Spottet" class="hero-carousel-image">
      <img src="Images/RobbieSpottet/RS-3.jpeg" alt="Robbie Spottet" class="hero-carousel-image">
    </div>
    <div class="hero-title-wrapper">
      <h1 class="hero-title">ROBBIE<br>SPOTTET</h1>
      <a href="#" class="camera-icon-link" id="camera-btn" aria-label="Camera">
        <img src="Images/Icons/Camera.png" alt="Camera" class="camera-icon">
      </a>
    </div>
    <button class="carousel-arrow left hero-arrow" aria-label="Previous">
      <img src="Images/Arrow Left.png" alt="">
    </button>
    <button class="carousel-arrow right hero-arrow" aria-label="Next">
      <img src="Images/Arrow Right.png" alt="">
    </button>
  </div>

  <section class="description">
    <p>Concrete that's been left alone long enough to tell the truth. Cracked surfaces, faded paint, tags layered over years. No signs, no rules posted, no one watching. It feels unused but not forgotten; it's waiting for the right session, not a crowd. You come here knowing what you're doing, or you don't stay long.</p>
    
    <div class="spot-details">
      <div class="detail-item">
        <span class="detail-label">DIFFICULTY:</span>
        <img src="Images/Difficulty/advanced.png" alt="Difficulty" class="detail-icon">
      </div>
      
      <div class="detail-item">
        <span class="detail-label">MAIN GEAR:</span>
        <img src="Images/Icons/skateboard (1).png" alt="Main Gear" class="detail-icon">
      </div>
    </div>

    <div class="schedule-section">
      <h4>Schedule:</h4>
      <div class="schedule-days">
        <div class="schedule-day"><span class="day-name">Monday:</span> <span class="day-schedule">Always Open</span></div>
        <div class="schedule-day"><span class="day-name">Tuesday:</span> <span class="day-schedule">Always Open</span></div>
        <div class="schedule-day"><span class="day-name">Wednesday:</span> <span class="day-schedule">Always Open</span></div>
        <div class="schedule-day"><span class="day-name">Thursday:</span> <span class="day-schedule">Always Open</span></div>
        <div class="schedule-day"><span class="day-name">Friday:</span> <span class="day-schedule">Always Open</span></div>
        <div class="schedule-day"><span class="day-name">Saturday:</span> <span class="day-schedule">Always Open</span></div>
        <div class="schedule-day"><span class="day-name">Sunday:</span> <span class="day-schedule">Always Open</span></div>
      </div>
    </div>

    <a href="#" class="btn">SCHEDULE A SESH</a>
  </section>

  <section class="discover">
    <h2>CHECK OUT<br>THE<br>SPOTS</h2>
  </section>

  <div class="carousel-wrapper">
    <section class="spot-carousel">

      <div class="spot">
        <h3>3M<br>Rail</h3>
        <img src="Images/Spots/3Mrail.png" alt="3M Rail" class="spot-image" />
        <div class="spot-info">
          <span class="label">Difficulty:</span>
          <img src="Images/Difficulty/intermediary.png" alt="Difficulty" class="difficulty-icon">
        </div>
        <a href="https://maps.app.goo.gl/hR4HF2QNPxzahwgB8" class="btn">Open Coordinates</a>
        <img src="Images/BackgroundGrunge.png" alt="" class="spot-background">
      </div>

      <div class="spot">
        <h3>Split<br>Rail</h3>
        <img src="Images/Spots/Splitrail.png" alt="Split Rail" class="spot-image" />
        <div class="spot-info">
          <span class="label">Difficulty:</span>
          <img src="Images/Difficulty/advanced.png" alt="Difficulty" class="difficulty-icon">
        </div>
        <a href="https://maps.app.goo.gl/hR4HF2QNPxzahwgB8" class="btn">Open Coordinates</a>
        <img src="Images/BackgroundGrunge.png" alt="" class="spot-background">
      </div>

      <div class="spot">
        <h3>3M<br>Ramp</h3>
        <img src="Images/Spots/3Mramp.png" alt="3M Ramp" class="spot-image" />
        <div class="spot-info">
          <span class="label">Difficulty:</span>
          <img src="Images/Difficulty/intermediary.png" alt="Difficulty" class="difficulty-icon">
        </div>
        <a href="https://maps.app.goo.gl/hR4HF2QNPxzahwgB8" class="btn">Open Coordinates</a>
        <img src="Images/BackgroundGrunge.png" alt="" class="spot-background">
      </div>

      <div class="spot">
        <h3>Big<br>Bowl</h3>
        <img src="Images/Spots/Bigbowl.png" alt="Big Bowl" class="spot-image" />
        <div class="spot-info">
          <span class="label">Difficulty:</span>
          <img src="Images/Difficulty/easy.png" alt="Difficulty" class="difficulty-icon">
        </div>
        <a href="https://maps.app.goo.gl/hR4HF2QNPxzahwgB8" class="btn">Open Coordinates</a>
        <img src="Images/BackgroundGrunge.png" alt="" class="spot-background">
      </div>

    </section>

    <button class="carousel-arrow left" aria-label="Previous">
      <img src="Images/Arrow Left.png" alt="">
    </button>
    
    <button class="carousel-arrow right" aria-label="Next">
      <img src="Images/Arrow Right.png" alt="">
    </button>
  </div>

  <section class="spot-map-section">
    <div class="location-header">
      <h3 class="location-title-left">SEE<br> THE<br> <span class="pink-text">MAP</span></h3>
      <h3 class="location-title-right"><br><br><br>FIND<br> A<br> <span class="pink-text">ROUTE</span></h3>
    </div>
    <div class="map-layout">
      <div class="route-buttons">
        <button class="route-button" data-route-index="1">RS to ASS</button>
        <button class="route-button" data-route-index="2">RS to LG</button>
      </div>
      <div class="map-wrapper" id="map-wrapper">
        <div class="map-container">
          <img src="Images/Map.png" class="map-image" id="map-image" alt="Map">
        </div>
        <button class="carousel-arrow left map-arrow" id="map-prev-btn" aria-label="Previous Route">
          <img src="Images/Arrow Left.png" alt="">
        </button>
        <button class="carousel-arrow right map-arrow" id="map-next-btn" aria-label="Next Route">
          <img src="Images/Arrow Right.png" alt="">
        </button>
        <div class="map-controls">
          <button class="map-reset-btn" id="reset-map" aria-label="Reset View">Reset</button>
          <button class="map-zoom-btn" id="zoom-out" aria-label="Zoom Out">−</button>
          <button class="map-zoom-btn" id="zoom-in" aria-label="Zoom In">+</button>
        </div>
      </div>
    </div>
    <a href="https://www.google.com/maps" class="btn">CREATE A ROUTE</a>
  </section>

  <footer>
    <img src="Images/Footer.png" alt="" class="footer-bg-image">
    <a href="index.html">Back to Home</a>
    <a href="#">About</a>
    <a href="#">Cookie Policy</a>
    <a href="#">Privacy Policy</a>
  </footer>


  <div class="modal-backdrop" id="sesh-modal">
    <div class="modal">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h3>Schedule a Sesh</h3>
  
      <label>
        Select Park
        <select class="modal-select">
          <option>Robbie Spottet</option>
          <option>Skate Scene</option>
          <option>Læssøes Gade</option>
        </select>
      </label>
  
      <label>
        Select Date
        <input type="date">
      </label>
  
      <label>
        Select Time
        <input type="time">
      </label>
  
      <div class="modal-actions">
        <button class="btn modal-btn modal-cancel">Cancel</button>
        <button class="btn modal-btn modal-confirm">Confirm</button>
      </div>
    </div>
  </div>

  <div class="modal-backdrop" id="camera-modal">
    <div class="modal">
      <button class="modal-close" aria-label="Close">&times;</button>
      <h3>Upload Photo</h3>
  
      <label>
        Select File
        <input type="file" id="file-input" accept="image/*">
      </label>

      <div id="file-preview" style="margin-bottom: 16px; display: none;">
        <img id="preview-image" src="" alt="Preview" style="max-width: 100%; max-height: 200px; border: 1px solid var(--gray);">
      </div>
  
      <div class="modal-actions">
        <button class="btn modal-btn modal-cancel">Cancel</button>
        <button class="btn modal-btn modal-confirm">Upload</button>
      </div>
    </div>
  </div>
  

<script>
  // Hero carousel
  const heroCarousel = document.querySelector('.hero-carousel');
  const heroImages = heroCarousel.querySelectorAll('.hero-carousel-image');
  const heroPrevBtn = document.querySelector('.hero-arrow.left');
  const heroNextBtn = document.querySelector('.hero-arrow.right');

  let heroIndex = 0;

  function updateHeroCarousel() {
    const heroWrapper = document.querySelector('.hero-carousel-wrapper');
    const imageWidth = heroWrapper.clientWidth || window.innerWidth;
    heroCarousel.style.transform = `translateX(${-heroIndex * imageWidth}px)`;
  }

  // Initialize carousel position
  updateHeroCarousel();

  // Update on window resize
  window.addEventListener('resize', updateHeroCarousel);

  heroNextBtn.addEventListener('click', () => {
    heroIndex = (heroIndex + 1) % heroImages.length;
    updateHeroCarousel();
  });

  heroPrevBtn.addEventListener('click', () => {
    heroIndex = (heroIndex - 1 + heroImages.length) % heroImages.length;
    updateHeroCarousel();
  });

  // Spots carousel
  const carousel = document.querySelector('.spot-carousel');
  const cards = carousel.querySelectorAll('.spot');
  const carouselWrapper = document.querySelector('.carousel-wrapper');
  const prevBtn = carouselWrapper.querySelector('.carousel-arrow.left');
  const nextBtn = carouselWrapper.querySelector('.carousel-arrow.right');

  let index = 0;

  function updateCarousel() {
    const cardWidth = cards[0].getBoundingClientRect().width + 24;
    carousel.style.transform = `translateX(${-index * cardWidth}px)`;
  }

  nextBtn.addEventListener('click', () => {
    index = (index + 1) % cards.length;
    updateCarousel();
  });

  prevBtn.addEventListener('click', () => {
    index = (index - 1 + cards.length) % cards.length;
    updateCarousel();
  });


  const openBtn = document.querySelector('.description .btn');
  const modal = document.getElementById('sesh-modal');
  
  if (openBtn && modal) {
    const cancelBtn = modal.querySelector('.modal-cancel');
    const confirmBtn = modal.querySelector('.modal-confirm');
    const closeBtn = modal.querySelector('.modal-close');

    let scrollY = 0;

    function openModal() {
      scrollY = window.scrollY;
      modal.classList.add('active');
      // Prevent background scrolling
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.classList.remove('active');
      // Restore scrolling
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      window.scrollTo(0, scrollY);
    }

    openBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openModal();
    });

    if (cancelBtn) {
      cancelBtn.addEventListener('click', closeModal);
    }

    if (confirmBtn) {
      confirmBtn.addEventListener('click', (e) => {
        e.preventDefault();
        // Add your form submission logic here
        closeModal();
      });
    }

    if (closeBtn) {
      closeBtn.addEventListener('click', closeModal);
    }

    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('active')) {
        closeModal();
      }
    });
  }

  // Camera upload modal
  const cameraBtn = document.getElementById('camera-btn');
  const cameraModal = document.getElementById('camera-modal');
  
  if (cameraBtn && cameraModal) {
    const cameraCancelBtn = cameraModal.querySelector('.modal-cancel');
    const cameraUploadBtn = cameraModal.querySelector('.modal-confirm');
    const cameraCloseBtn = cameraModal.querySelector('.modal-close');
    const fileInput = document.getElementById('file-input');
    const filePreview = document.getElementById('file-preview');
    const previewImage = document.getElementById('preview-image');

    let scrollY = 0;

    function openCameraModal() {
      scrollY = window.scrollY;
      cameraModal.classList.add('active');
      // Prevent background scrolling
      document.body.style.position = 'fixed';
      document.body.style.top = `-${scrollY}px`;
      document.body.style.width = '100%';
      document.body.style.overflow = 'hidden';
    }

    function closeCameraModal() {
      cameraModal.classList.remove('active');
      // Restore scrolling
      document.body.style.position = '';
      document.body.style.top = '';
      document.body.style.width = '';
      document.body.style.overflow = '';
      window.scrollTo(0, scrollY);
      // Reset file input and preview
      fileInput.value = '';
      filePreview.style.display = 'none';
      previewImage.src = '';
    }

    cameraBtn.addEventListener('click', (e) => {
      e.preventDefault();
      openCameraModal();
    });

    if (cameraCancelBtn) {
      cameraCancelBtn.addEventListener('click', closeCameraModal);
    }

    if (cameraUploadBtn) {
      cameraUploadBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (fileInput.files && fileInput.files.length > 0) {
          // Add your upload logic here
          console.log('Uploading file:', fileInput.files[0]);
          // For now, just close the modal
          closeCameraModal();
        } else {
          alert('Please select a file to upload');
        }
      });
    }

    if (cameraCloseBtn) {
      cameraCloseBtn.addEventListener('click', closeCameraModal);
    }

    cameraModal.addEventListener('click', (e) => {
      if (e.target === cameraModal) {
        closeCameraModal();
      }
    });

    // File preview
    if (fileInput) {
      fileInput.addEventListener('change', (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = (event) => {
            previewImage.src = event.target.result;
            filePreview.style.display = 'block';
          };
          reader.readAsDataURL(file);
        } else {
          filePreview.style.display = 'none';
          previewImage.src = '';
        }
      });
    }

    // Close modal on Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && cameraModal.classList.contains('active')) {
        closeCameraModal();
      }
    });
  }

  // Map functionality with routes, zoom, and drag
  const mapWrapper = document.getElementById('map-wrapper');
  const mapImage = document.getElementById('map-image');
  const mapContainer = mapWrapper.querySelector('.map-container');
  const mapPrevBtn = document.getElementById('map-prev-btn');
  const mapNextBtn = document.getElementById('map-next-btn');
  const zoomInBtn = document.getElementById('zoom-in');
  const zoomOutBtn = document.getElementById('zoom-out');
  const resetBtn = document.getElementById('reset-map');
  const routeButtons = document.querySelectorAll('.route-button');

  // Route images
  const routes = [
    { name: 'Base Map', src: 'Images/Map.png' },
    { name: 'RS to ASS', src: 'Images/Routes/RS-ASSRoute.png' },
    { name: 'RS to LG', src: 'Images/Routes/RS-LGRoute.png' }
  ];

  let currentRouteIndex = 0;
  let scale = 1;
  let translateX = 0;
  let translateY = 0;
  let isDragging = false;
  let dragStartX = 0;
  let dragStartY = 0;
  let dragStartTranslateX = 0;
  let dragStartTranslateY = 0;
  let imageLoaded = false;
  let naturalWidth = 0;
  let naturalHeight = 0;

  const MAX_SCALE = 15; // Can zoom in much more
  const ZOOM_STEP = 0.2;
  // Minimum scale is computed dynamically so the map always covers the wrapper
  function computeMinScale() {
    if (!imageLoaded) return 1;
    const rect = mapWrapper.getBoundingClientRect();
    const wrapperWidth = rect.width;
    const wrapperHeight = rect.height;

    if (!wrapperWidth || !wrapperHeight || !naturalWidth || !naturalHeight) {
      return 1;
    }

    const ratio = naturalWidth / naturalHeight;
    // At scale = 1, displayedHeight = wrapperHeight, displayedWidth = ratio * wrapperHeight.
    // Ensure the image is never smaller than the wrapper in either dimension.
    const minScaleForWidth = wrapperWidth / (ratio * wrapperHeight);
    const minScaleForHeight = 1; // because displayedHeight = wrapperHeight at scale 1

    return Math.max(1, minScaleForWidth, minScaleForHeight);
  }

  const MIN_SCALE = 1; // base lower bound; real min enforced by computeMinScale

  // Load image and get dimensions
  function loadMapImage(src) {
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => {
        naturalWidth = img.naturalWidth;
        naturalHeight = img.naturalHeight;
        imageLoaded = true;
        resolve();
      };
      img.src = src;
    });
  }

  // Constrain translation so the map never leaves empty space inside the wrapper
  function clampTranslation() {
    const rect = mapWrapper.getBoundingClientRect();
    const wrapperWidth = rect.width;
    const wrapperHeight = rect.height;

    // Image is height: 100% of wrapper, width auto, then scaled.
    const displayedHeight = wrapperHeight * scale;
    const displayedWidth = (naturalWidth / naturalHeight) * wrapperHeight * scale;

    const minTranslateX = Math.min(0, wrapperWidth - displayedWidth);
    const maxTranslateX = 0;
    const minTranslateY = Math.min(0, wrapperHeight - displayedHeight);
    const maxTranslateY = 0;

    translateX = Math.min(maxTranslateX, Math.max(minTranslateX, translateX));
    translateY = Math.min(maxTranslateY, Math.max(minTranslateY, translateY));
  }

  // Update map transform
  function updateMapTransform() {
    clampTranslation();
    mapImage.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
  }

  // Reset map to default view
  function resetMapView() {
    scale = computeMinScale();
    translateX = 0;
    translateY = 0;
    updateMapTransform();
  }

  // Zoom in/out
  function zoomMap(delta, clientX, clientY) {
    if (!imageLoaded) return;

    const rect = mapWrapper.getBoundingClientRect();
    const wrapperCenterX = rect.left + rect.width / 2;
    const wrapperCenterY = rect.top + rect.height / 2;

    // Use provided point or center of wrapper
    const zoomPointX = clientX !== undefined ? clientX - rect.left : rect.width / 2;
    const zoomPointY = clientY !== undefined ? clientY - rect.top : rect.height / 2;

    const oldScale = scale;
    const minScale = computeMinScale();
    scale = Math.max(minScale, Math.min(MAX_SCALE, scale + delta));

    if (scale !== oldScale) {
      // Calculate the point in image coordinates before zoom
      const imageX = (zoomPointX - translateX) / oldScale;
      const imageY = (zoomPointY - translateY) / oldScale;

      // Adjust translation to keep the zoom point fixed
      translateX = zoomPointX - imageX * scale;
      translateY = zoomPointY - imageY * scale;

      updateMapTransform();
    }
  }

  // Switch route
  async function switchRoute(direction) {
    currentRouteIndex = (currentRouteIndex + direction + routes.length) % routes.length;
    const route = routes[currentRouteIndex];
    
    // Reset view when switching routes
    resetMapView();
    
    // Load new image
    imageLoaded = false;
    mapImage.style.opacity = '0.5';
    
    await loadMapImage(route.src);
    mapImage.src = route.src;
    
    mapImage.onload = () => {
      mapImage.style.opacity = '1';
      resetMapView();
    };
  }

  // Mouse drag handlers
  mapContainer.addEventListener('mousedown', (e) => {
    if (e.button === 0) { // Left mouse button
      isDragging = true;
      dragStartX = e.clientX;
      dragStartY = e.clientY;
      dragStartTranslateX = translateX;
      dragStartTranslateY = translateY;
      mapImage.style.cursor = 'grabbing';
      mapImage.classList.add('dragging');
      e.preventDefault();
    }
  });

  document.addEventListener('mousemove', (e) => {
    if (isDragging) {
      translateX = dragStartTranslateX + (e.clientX - dragStartX);
      translateY = dragStartTranslateY + (e.clientY - dragStartY);
      updateMapTransform();
    }
  });

  document.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      mapImage.style.cursor = 'grab';
      mapImage.classList.remove('dragging');
    }
  });

  // Touch drag handlers
  let touchStartDistance = 0;
  let touchStartScale = 1;
  let touchStartTranslateX = 0;
  let touchStartTranslateY = 0;
  let lastTouchCenterX = 0;
  let lastTouchCenterY = 0;

  mapContainer.addEventListener('touchstart', (e) => {
    if (e.touches.length === 1) {
      // Single touch - drag
      isDragging = true;
      const touch = e.touches[0];
      dragStartX = touch.clientX;
      dragStartY = touch.clientY;
      dragStartTranslateX = translateX;
      dragStartTranslateY = translateY;
      mapImage.classList.add('dragging');
    } else if (e.touches.length === 2) {
      // Two touches - pinch zoom
      isDragging = false;
      const touch1 = e.touches[0];
      const touch2 = e.touches[1];
      touchStartDistance = Math.hypot(
        touch2.clientX - touch1.clientX,
        touch2.clientY - touch1.clientY
      );
      touchStartScale = scale;
      touchStartTranslateX = translateX;
      touchStartTranslateY = translateY;
      mapImage.classList.add('dragging');
      
      lastTouchCenterX = (touch1.clientX + touch2.clientX) / 2;
      lastTouchCenterY = (touch1.clientY + touch2.clientY) / 2;
    }
    e.preventDefault();
  });

  mapContainer.addEventListener('touchmove', (e) => {
    if (e.touches.length === 1 && isDragging) {
      // Single touch - drag
      const touch = e.touches[0];
      translateX = dragStartTranslateX + (touch.clientX - dragStartX);
      translateY = dragStartTranslateY + (touch.clientY - dragStartY);
      updateMapTransform();
    } else if (e.touches.length === 2) {
      // Two touches - pinch zoom
      isDragging = false;
      const touch1 = e.touches[0];
      const touch2 = e.touches[1];
      const distance = Math.hypot(
        touch2.clientX - touch1.clientX,
        touch2.clientY - touch1.clientY
      );
      
      const scaleFactor = distance / touchStartDistance;
      const minScale = computeMinScale();
      scale = Math.max(minScale, Math.min(MAX_SCALE, touchStartScale * scaleFactor));
      
      const centerX = (touch1.clientX + touch2.clientX) / 2;
      const centerY = (touch1.clientY + touch2.clientY) / 2;
      const rect = mapWrapper.getBoundingClientRect();
      const zoomPointX = centerX - rect.left;
      const zoomPointY = centerY - rect.top;
      
      const imageX = (zoomPointX - touchStartTranslateX) / touchStartScale;
      const imageY = (zoomPointY - touchStartTranslateY) / touchStartScale;
      
      translateX = zoomPointX - imageX * scale;
      translateY = zoomPointY - imageY * scale;
      
      updateMapTransform();
    }
    e.preventDefault();
  });

  mapContainer.addEventListener('touchend', () => {
    isDragging = false;
    mapImage.classList.remove('dragging');
  });

  // Mouse wheel zoom
  mapContainer.addEventListener('wheel', (e) => {
    e.preventDefault();
    const delta = e.deltaY > 0 ? -ZOOM_STEP : ZOOM_STEP;
    zoomMap(delta, e.clientX, e.clientY);
  });

  // Button handlers
  mapPrevBtn.addEventListener('click', () => switchRoute(-1));
  mapNextBtn.addEventListener('click', () => switchRoute(1));
  zoomInBtn.addEventListener('click', () => {
    const rect = mapWrapper.getBoundingClientRect();
    zoomMap(ZOOM_STEP, rect.left + rect.width / 2, rect.top + rect.height / 2);
  });
  zoomOutBtn.addEventListener('click', () => {
    const rect = mapWrapper.getBoundingClientRect();
    zoomMap(-ZOOM_STEP, rect.left + rect.width / 2, rect.top + rect.height / 2);
  });
  resetBtn.addEventListener('click', resetMapView);

  // Desktop route buttons: jump directly to specific routes
  if (routeButtons && routeButtons.length) {
    routeButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const targetIndex = parseInt(btn.dataset.routeIndex, 10);
        if (Number.isNaN(targetIndex)) return;
        const delta = targetIndex - currentRouteIndex;
        if (delta !== 0) {
          switchRoute(delta);
        }

        routeButtons.forEach((b) => b.classList.remove('active'));
        btn.classList.add('active');
      });
    });
  }

  // Initialize
  mapImage.style.cursor = 'grab';
  loadMapImage(routes[currentRouteIndex].src).then(() => {
    mapImage.src = routes[currentRouteIndex].src;
    resetMapView();
  });

  // Burger menu functionality
  const burgerMenuBtn = document.getElementById('burger-menu-btn');
  const slideMenu = document.getElementById('slide-menu');
  const slideMenuClose = document.getElementById('slide-menu-close');

  const slideMenuBackdrop = document.getElementById('slide-menu-backdrop');

  function openMenu() {
    slideMenu.classList.add('active');
    slideMenuBackdrop.classList.add('active');
    burgerMenuBtn.classList.add('active');
    document.body.style.overflow = 'hidden';
  }

  function closeMenu() {
    slideMenu.classList.remove('active');
    slideMenuBackdrop.classList.remove('active');
    burgerMenuBtn.classList.remove('active');
    document.body.style.overflow = '';
  }

  if (burgerMenuBtn) {
    burgerMenuBtn.addEventListener('click', openMenu);
  }

  if (slideMenuClose) {
    slideMenuClose.addEventListener('click', closeMenu);
  }

  if (slideMenuBackdrop) {
    slideMenuBackdrop.addEventListener('click', closeMenu);
  }

  // Close menu on Escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && slideMenu.classList.contains('active')) {
      closeMenu();
    }
  });
</script>

</body>
</html>
